databases:
  - name: cgf-scheduler-db
    plan: free
    databaseName: schedule
    user: scheduler

services:
  - type: web
    name: cgf-livestream-scheduler
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn run:app
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: SCHEDULE_SECRET_KEY
        generateValue: true
      - key: DATABASE_URL
        fromDatabase:
          name: cgf-scheduler-db
          property: connectionString
      - key: BASE_URL
        sync: false
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_CHAT_ID
        sync: false

  # Keep-alive cron job - pings the app every 5 minutes to prevent sleeping
  - type: cron
    name: cgf-scheduler-keepalive
    runtime: python
    schedule: "*/5 * * * *"  # Every 5 minutes
    buildCommand: pip install -r requirements.txt
    startCommand: "curl https://livestream-schedule.onrender.com || echo 'Ping failed'"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0

  # Daily Reminder Cron - Sends Telegram messages at 8 AM PST (16:00 UTC)
  - type: cron
    name: daily-reminders
    runtime: python
    schedule: "0 16 * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: "curl --retry 3 --retry-delay 10 --max-time 120 https://livestream-schedule.onrender.com/cron/daily-reminder"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
